# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Game Design Document

The core GDD is `god_is_a_dj_gdd.md` in the repo root. Consult it for game design details — mechanics, features, narrative, progression, and any design intent questions.

## Project Overview

Unity 6 (version 6000.3.5f1) 2D **WebGL** game project for Global Game Jam 2026, themed "Masks". Target platform is WebGL — this constrains networking to WebSocket-based protocols (no UDP).

## Build & Run

This is a Unity project — open and run through Unity Editor (version 6000.3.5f1). No CLI build pipeline. Solution/csproj files are auto-generated by Unity.

- **Open project:** Unity Hub → open this directory
- **Play:** Press Play in Unity Editor
- **Tests:** Window > General > Test Runner (com.unity.test-framework 1.6.0)

## Architecture

- **Rendering:** Universal Render Pipeline 2D (URP 17.3.0) — configured in `Assets/Settings/Renderer2D.asset` and `Assets/Settings/UniversalRP.asset`
- **Networking:** Photon Fusion 2 — see `Docs/PhotonFusion2.md` for full API reference
- **Input:** New Input System (1.17.0) via `Assets/InputSystem_Actions.inputactions` — pre-configured Player action map with Move, Look, Attack, Interact (hold), Crouch, Jump, Sprint, Previous/Next for keyboard/mouse and gamepad
- **Async:** UniTask (2.5.10) via OpenUPM scoped registry — prefer UniTask over coroutines for async code
- **2D Tooling:** Sprite, Animation, Tilemap, SpriteShape, Aseprite/PSD importers available
- **Scenes:** `Assets/Scenes/SampleScene.unity` is the main scene

## Networking Layer

The communication layer lives in `Assets/Scripts/Network/` and uses Photon Fusion 2 in **Shared Mode** (`GameMode.Shared`). Shared Mode is required for WebGL (no UDP — only WebSocket). Each player has state authority over objects they spawn; there is no single authoritative host.

### Scripts

- **`PlayerInputData.cs`** — `INetworkInput` struct (currently unused but kept for future Host/Client needs).
- **`GameLauncher.cs`** — Session lifecycle manager (`MonoBehaviour` + `INetworkRunnerCallbacks`). Creates a `NetworkRunner`, starts the game in Shared Mode, spawns/despawns player prefabs on join/leave.
- **`PlayerController.cs`** — `NetworkBehaviour` on the player prefab. Reads input directly (not via Fusion's input pipeline — that's for Host/Client mode). Uses `[Networked] Vector3 NetworkPosition` for replication and `Render()` with lerp for smooth interpolation on proxies.

### Player Prefab Requirements

The player prefab must have these components:
- `NetworkObject` (network identity)
- `PlayerController` (movement + position replication via `[Networked]` property)
- `SpriteRenderer` (or other visual)
- Assign `InputSystem_Actions` asset to PlayerController's Input Actions field

Note: `NetworkTransform` is NOT needed — position replication is handled by the `[Networked]` property in PlayerController.

### Adding New Networked Behaviour

1. Add `[Networked]` auto-properties to `PlayerController` (or new `NetworkBehaviour` scripts)
2. Guard writes with `if (HasStateAuthority)` — in Shared Mode each peer owns its own objects
3. For one-time events across players, use `[Rpc]` methods

## Key Conventions

- C# scripts go under `Assets/` in appropriate subdirectories
- Editor-only scripts must be in `Editor/` folders to avoid build errors
- Color space is **Linear** (not Gamma) — affects shader and texture work
- Package dependencies managed in `Packages/manifest.json` (OpenUPM scoped registry for UniTask)
- Networked objects use `Runner.Spawn()` — never `GameObject.Instantiate()` for networked prefabs
- Use `[Networked]` auto-properties for synced state, RPCs for one-time cross-player events
- Use `NetworkBool` instead of `bool` and `NetworkString<_N>` instead of `string` in networked properties
